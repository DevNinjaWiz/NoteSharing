<div class="dashboard">
  <app-dashboard-menu
    [sideNavLinks]="sideNavLinks"
    [selectedNav]="selectedNav()"
    (navSelected)="selectNav($event)"
    [notebooks]="notebooks()"
    [selectedNotebookId]="selectedNotebookId()"
    [notebooksExpanded]="notebooksExpanded()"
    (notebooksToggle)="toggleNotebooks()"
    (notebookSelected)="selectNotebook($event)"
    [notebooksLoading]="notebooksLoading()"
    [notebooksError]="notebooksError()"
    [friends]="friends()"
    [friendsExpanded]="friendsExpanded()"
    (friendsToggle)="toggleFriends()"
    [friendsLoading]="friendsLoading()"
    [friendsError]="friendsError()"
  ></app-dashboard-menu>

  <main class="dashboard__main">
    <app-dashboard-header
      [theme]="theme()"
      (themeToggle)="toggleTheme()"
      (logoutRequested)="logout()"
    ></app-dashboard-header>

    <section class="dashboard__content">
      <div class="dashboard__heading">
        <div>
          <p class="dashboard__eyebrow">Workspace overview</p>
          <h1>{{ currentViewTitle() }}</h1>
          <p class="dashboard__meta">
            {{ currentCount() }} {{ currentCount() === 1 ? 'note' : 'notes' }}
          </p>
        </div>
        <div class="dashboard__toolbar">
          <ui-select
            class="dashboard__sortControl"
            label="Sort By"
            tooltip="Change note sorting"
            [options]="sortOptions"
            [value]="sortMode()"
            (valueChange)="setSortMode($event)"
          ></ui-select>
          <div class="dashboard__viewToggle">
            <button
              type="button"
              [class.is-active]="viewMode() === 'grid'"
              aria-label="Grid view"
              [attr.aria-pressed]="viewMode() === 'grid'"
              (click)="setViewMode('grid')"
              title="Switch to grid view"
            >
              <span class="material-symbols-outlined" aria-hidden="true">
                grid_view
              </span>
            </button>
            <button
              type="button"
              [class.is-active]="viewMode() === 'list'"
              aria-label="List view"
              [attr.aria-pressed]="viewMode() === 'list'"
              (click)="setViewMode('list')"
              title="Switch to list view"
            >
              <span class="material-symbols-outlined" aria-hidden="true">
                list
              </span>
            </button>
          </div>
        </div>
      </div>

      @if (isLoading()) {
        <p class="dashboard__status">
          <span class="material-symbols-outlined" aria-hidden="true">
            refresh
          </span>
          Syncing notes...
        </p>
      }

      @if (error()) {
        <p class="dashboard__status dashboard__status--error">
          <span class="material-symbols-outlined" aria-hidden="true">
            warning
          </span>
          {{ error() }}
        </p>
      }

      @if (filteredNotes().length) {
        <div
          class="dashboard__grid"
          [class.is-list]="viewMode() === 'list'"
          [class.dashboard__grid--compact]="
            isFavoritesView() && viewMode() === 'grid'
          "
        >
          @for (note of filteredNotes(); track note.id; let i = $index) {
            <app-note-card
              [note]="note"
              [viewMode]="viewMode()"
              [previewIndex]="i"
              [isTrashView]="isTrashView()"
              [metaText]="'Edited ' + formatUpdatedAt(note)"
              [trashLocation]="isTrashView() ? notebookPath(note) : ''"
              [trashDeletedAt]="isTrashView() ? formatDeletedAt(note) : ''"
              (favoriteToggle)="toggleFavorite(note)"
              (deleteRequested)="deleteNote(note)"
              (restoreRequested)="restoreNote(note)"
              (deleteForeverRequested)="deleteNoteForever(note)"
            />
          }
        </div>
      } @else {
        <div class="dashboard__empty">
          <span class="material-symbols-outlined" aria-hidden="true">
            bookmark_add
          </span>
          @if (isTrashView()) {
            <h2>No notes in Trash</h2>
            <p>Deleted notes will stay here for review until you remove them.</p>
          } @else {
            <h2>Start your first note</h2>
            <p>
              Capture meeting recaps, ideas, and todos. Your notes will appear
              here once saved.
            </p>
          }
        </div>
      }
    </section>
  </main>
</div>

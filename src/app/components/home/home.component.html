<div class="home">
  <header class="home__header">
    <div>
      <p class="home__eyebrow">Welcome back</p>
      <h1>Manage your notes</h1>
    </div>
    <div class="home__actions">
      <button type="button" (click)="refreshNotes()" title="Reload your notes">
        Reload Notes
      </button>
      <button type="button" (click)="logout()" title="Log out of the app">
        Logout
      </button>
      <a routerLink="/dashboard">Go to Dashboard</a>
    </div>
  </header>

  <section class="home__form">
    <h2>{{ editingNoteId ? 'Update note' : 'Create a note' }}</h2>
    <form [formGroup]="noteForm" (ngSubmit)="submitNote()">
      <label class="home__field">
        <span>Title</span>
        <input
          type="text"
          placeholder="Give your note a title"
          formControlName="title"
        />
      </label>
      <label class="home__field">
        <span>Content</span>
        <textarea
          rows="3"
          placeholder="Add some details..."
          formControlName="content"
        ></textarea>
      </label>
      <div class="home__formActions">
        <button
          type="submit"
          [disabled]="noteForm.invalid"
          title="{{ editingNoteId ? 'Save changes to this note' : 'Create note' }}"
        >
          {{ editingNoteId ? 'Save Changes' : 'Add Note' }}
        </button>
        <button
          type="button"
          *ngIf="editingNoteId"
          (click)="cancelEdit()"
          title="Cancel editing"
        >
          Cancel
        </button>
      </div>
    </form>
  </section>

  <section class="home__status" *ngIf="notesStore.isLoading()">
    Loading notes...
  </section>

  <section
    class="home__status error"
    *ngIf="!notesStore.isLoading() && notesStore.error() as error"
  >
    <p>Failed to load notes: {{ error }}</p>
  </section>

  <section
    class="home__notes"
    *ngIf="!notesStore.isLoading() && notesStore.activeNotes().length; else emptyNotes"
  >
    <div class="home__notesHeader">
      <h2>Your Notes</h2>
      <button type="button" (click)="refreshNotes()" title="Refresh notes list">
        Refresh
      </button>
    </div>
    <ul>
      <li *ngFor="let note of notesStore.activeNotes(); trackBy: trackByNoteId">
        <div class="home__noteHeader">
          <h3>{{ note.title || 'Untitled note' }}</h3>
          <div class="home__noteActions">
            <button
              type="button"
              (click)="startEdit(note)"
              title="Edit this note"
            >
              Edit
            </button>
            <button
              type="button"
              (click)="deleteNote(note.id)"
              title="Delete this note"
            >
              Delete
            </button>
          </div>
        </div>
        <p>{{ note.content || 'No content available.' }}</p>
      </li>
    </ul>
  </section>

  <ng-template #emptyNotes>
    <section class="home__empty">
      <p>No notes yet. Use the form above to create your first note.</p>
    </section>
  </ng-template>
</div>
